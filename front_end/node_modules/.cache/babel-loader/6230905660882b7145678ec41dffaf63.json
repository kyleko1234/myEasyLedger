{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nexports.__esModule = true;\n\nvar crypto_1 = __importDefault(require(\"crypto\"));\n\nvar utils_1 = require(\"./utils\");\n\nvar ALGORITHM = \"aes-256-ctr\";\nvar HMAC_ALGORITHM = \"sha256\";\n\nfunction getEncryptionKey(key) {\n  var encryptionKey = key || process.env.ENCRYPTION_KEY;\n\n  if (!encryptionKey) {\n    throw new Error(\"No encryption key was found\");\n  }\n\n  var cryptoKey = crypto_1[\"default\"].createHash(\"sha256\").update(encryptionKey).digest();\n  return cryptoKey;\n}\n\nfunction constantTimeCompare(val1, val2) {\n  if (val1.length !== val2.length) {\n    return false;\n  }\n\n  var sentinel = 0;\n\n  for (var i = 0, len = val1.length; i < len; i++) {\n    sentinel |= val1.charCodeAt(i) ^ val2.charCodeAt(i);\n  }\n\n  return sentinel === 0;\n}\n\nfunction encrypt(value, key) {\n  var iv = Buffer.from(crypto_1[\"default\"].randomBytes(16));\n  var encryptionKey = Buffer.from(getEncryptionKey(key));\n  var cipher = crypto_1[\"default\"].createCipheriv(ALGORITHM, encryptionKey, iv);\n  cipher.setEncoding(\"hex\");\n  cipher.write(utils_1.stringify(value));\n  cipher.end();\n  var cipherText = cipher.read();\n  var hmac = crypto_1[\"default\"].createHmac(HMAC_ALGORITHM, encryptionKey);\n  hmac.update(cipherText);\n  hmac.update(iv.toString(\"hex\"));\n  return cipherText + \"$\" + iv.toString(\"hex\") + \"$\" + hmac.digest(\"hex\");\n}\n\nexports.encrypt = encrypt;\n\nfunction decrypt(value, key) {\n  var cipher = value.split(\"$\");\n  var iv = Buffer.from(cipher[1], \"hex\");\n  var encryptionKey = Buffer.from(getEncryptionKey(key));\n  var hmac = crypto_1[\"default\"].createHmac(HMAC_ALGORITHM, encryptionKey);\n  hmac.update(cipher[0]);\n  hmac.update(iv.toString(\"hex\"));\n\n  if (!constantTimeCompare(hmac.digest(\"hex\"), cipher[2])) {\n    throw new Error(\"Encrypted payload has been tampered with\");\n  }\n\n  var decipher = crypto_1[\"default\"].createDecipheriv(ALGORITHM, encryptionKey, iv);\n  var decryptedText = decipher.update(cipher[0], \"hex\");\n  var final = \"\" + decryptedText + decipher.final();\n\n  try {\n    return JSON.parse(final);\n  } catch (err) {\n    return final;\n  }\n}\n\nexports.decrypt = decrypt;","map":{"version":3,"sources":["/Users/kyle/Easy_Ledger/template_react/node_modules/crypto-extra/dist/encryption.js"],"names":["__importDefault","mod","__esModule","exports","crypto_1","require","utils_1","ALGORITHM","HMAC_ALGORITHM","getEncryptionKey","key","encryptionKey","process","env","ENCRYPTION_KEY","Error","cryptoKey","createHash","update","digest","constantTimeCompare","val1","val2","length","sentinel","i","len","charCodeAt","encrypt","value","iv","Buffer","from","randomBytes","cipher","createCipheriv","setEncoding","write","stringify","end","cipherText","read","hmac","createHmac","toString","decrypt","split","decipher","createDecipheriv","decryptedText","final","JSON","parse","err"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nexports.__esModule = true;\nvar crypto_1 = __importDefault(require(\"crypto\"));\nvar utils_1 = require(\"./utils\");\nvar ALGORITHM = \"aes-256-ctr\";\nvar HMAC_ALGORITHM = \"sha256\";\nfunction getEncryptionKey(key) {\n    var encryptionKey = key || process.env.ENCRYPTION_KEY;\n    if (!encryptionKey) {\n        throw new Error(\"No encryption key was found\");\n    }\n    var cryptoKey = crypto_1[\"default\"]\n        .createHash(\"sha256\")\n        .update(encryptionKey)\n        .digest();\n    return cryptoKey;\n}\nfunction constantTimeCompare(val1, val2) {\n    if (val1.length !== val2.length) {\n        return false;\n    }\n    var sentinel = 0;\n    for (var i = 0, len = val1.length; i < len; i++) {\n        sentinel |= val1.charCodeAt(i) ^ val2.charCodeAt(i);\n    }\n    return sentinel === 0;\n}\nfunction encrypt(value, key) {\n    var iv = Buffer.from(crypto_1[\"default\"].randomBytes(16));\n    var encryptionKey = Buffer.from(getEncryptionKey(key));\n    var cipher = crypto_1[\"default\"].createCipheriv(ALGORITHM, encryptionKey, iv);\n    cipher.setEncoding(\"hex\");\n    cipher.write(utils_1.stringify(value));\n    cipher.end();\n    var cipherText = cipher.read();\n    var hmac = crypto_1[\"default\"].createHmac(HMAC_ALGORITHM, encryptionKey);\n    hmac.update(cipherText);\n    hmac.update(iv.toString(\"hex\"));\n    return cipherText + \"$\" + iv.toString(\"hex\") + \"$\" + hmac.digest(\"hex\");\n}\nexports.encrypt = encrypt;\nfunction decrypt(value, key) {\n    var cipher = value.split(\"$\");\n    var iv = Buffer.from(cipher[1], \"hex\");\n    var encryptionKey = Buffer.from(getEncryptionKey(key));\n    var hmac = crypto_1[\"default\"].createHmac(HMAC_ALGORITHM, encryptionKey);\n    hmac.update(cipher[0]);\n    hmac.update(iv.toString(\"hex\"));\n    if (!constantTimeCompare(hmac.digest(\"hex\"), cipher[2])) {\n        throw new Error(\"Encrypted payload has been tampered with\");\n    }\n    var decipher = crypto_1[\"default\"].createDecipheriv(ALGORITHM, encryptionKey, iv);\n    var decryptedText = decipher.update(cipher[0], \"hex\");\n    var final = \"\" + decryptedText + decipher.final();\n    try {\n        return JSON.parse(final);\n    }\n    catch (err) {\n        return final;\n    }\n}\nexports.decrypt = decrypt;\n"]},"metadata":{},"sourceType":"script"}